<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyecto Alpha - Tierra con Contorno</title>
  <link rel="stylesheet" href="css/styles.css"> <!-- Vincula el archivo CSS -->
</head>
<body>
  <!-- Pantalla de Inicio -->
  <div id="start-screen">
    <div class="overlay"></div>
    <button class="start-button" onclick="startApp()">Empezar</button>
  </div>
  <div id="overlay"></div>
  <audio id="backButtonSound" src="media/audio/effects/efecto2.mp3"></audio>

  <!-- Panel Interactivo -->
  <div id="info-panel">
    <button id="close-btn">✖</button>
    <h2 id="country-name"></h2>
    <p><strong>Capital:</strong> <span id="capital"></span></p>
    <p><strong>Población:</strong> <span id="population"></span></p>
    <img id="flag" src="" alt="Bandera">
    <audio id="anthem" controls></audio>
    <video id="video" controls></video>
  </div>

  <!-- Botón Volver -->
  <button id="back-button" onclick="backToStartScreen()">Volver</button>

  <!-- Botones de región -->
  <div id="button-container">
    <button class="region-button">Sudamérica</button>
    <button class="region-button">Norteamérica</button>
    <button class="region-button">Centroamérica</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    const clickSound = new Audio('media/audio/effects/efecto1.mp3');

    document.querySelector('.start-button').addEventListener('click', function() {
      clickSound.play();
    });

    window.onload = function() {
      setTimeout(() => {
        document.querySelector('.start-button').classList.add('show');
      }, 500);
    };

    let isRotating = true;
    let targetRotation = new THREE.Vector3(0, 0, 0);
    let rotationSpeed = 0.05;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 5000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const earthGeometry = new THREE.SphereGeometry(600, 64, 64);
    const normalTexture = new THREE.TextureLoader().load('textures/earthtexture.png');
    const earthMaterial = new THREE.MeshStandardMaterial({ map: normalTexture });
    const earth = new THREE.Mesh(earthGeometry, earthMaterial);
    scene.add(earth);

    const loader = new THREE.TextureLoader();
    loader.load('textures/cosmos.jpg', (texture) => {
      texture.minFilter = THREE.LinearFilter;
      texture.magFilter = THREE.LinearFilter;
      texture.generateMipmaps = false;
      scene.background = texture;
    });

    camera.position.set(150, 0, 1550);
    camera.lookAt(earth.position);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(1000, 1000, 1000);
    scene.add(light);
    const ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    
    earth.material.map = normalTexture;

    let isHoveringSouthAmerica = false;




    window.addEventListener('click', onEarthClick);

    function onEarthClick(event) {
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObject(earth);

  if (intersects.length > 0) {
    const intersect = intersects[0];
    const point = intersect.point.normalize(); // Normaliza el punto de intersección
    const lat = Math.asin(point.y) * (180 / Math.PI); // Calcula la latitud
    const lon = Math.atan2(point.x, point.z) * (180 / Math.PI); // Calcula la longitud

    console.log(`Latitud: ${lat.toFixed(2)}, Longitud: ${lon.toFixed(2)}`);

    // Verifica si las coordenadas están dentro del margen del país
    for (let country in countriesData) {
      const countryData = countriesData[country];
      const countryLat = countryData.lat;
      const countryLon = countryData.lon;
      const margin = countryData.clickMargin || 5; // Usa el margen del país o 5 por defecto

      if (Math.abs(lat - countryLat) < margin && Math.abs(lon - countryLon) < margin) {
        showCountryInfo(country, countryData);
        break;
      }
    }
  }
}
      
    function animate() {
      requestAnimationFrame(animate);

      if (isRotating) {
        earth.rotation.y += 0.003;
      } else {
        earth.rotation.x = THREE.MathUtils.lerp(earth.rotation.x, targetRotation.x, rotationSpeed);
        earth.rotation.y = THREE.MathUtils.lerp(earth.rotation.y, targetRotation.y, rotationSpeed);
        earth.rotation.z = THREE.MathUtils.lerp(earth.rotation.z, targetRotation.z, rotationSpeed);
      }

      renderer.render(scene, camera);
    }

    animate();

    function startApp() {
      const startScreen = document.getElementById('start-screen');
      const overlay = document.querySelector('.overlay');
      const buttonContainer = document.getElementById('button-container');

      overlay.classList.add('hidden');
      startScreen.classList.add('fade-out');

      setTimeout(() => {
        startScreen.style.display = 'none';
      }, 1500);

      setTimeout(() => {
        buttonContainer.classList.add('visible');
      }, 1500); // Esto hará que los botones aparezcan después de 0.5 segundos

      isRotating = false;
      targetRotation.set(0, 0, 0);
      document.getElementById('back-button').classList.add('show');
    }

    function backToStartScreen() {
      const startScreen = document.getElementById('start-screen');
      const overlay = document.querySelector('.overlay');
      const backSound = document.getElementById('backButtonSound');
      const buttonContainer = document.getElementById('button-container');

      backSound.currentTime = 0;
      backSound.play();

      buttonContainer.classList.add('fade-out'); 

      setTimeout(() => {
        startScreen.style.display = 'block';
        startScreen.classList.remove('fade-out');
        overlay.classList.remove('hidden');
        document.querySelector('.start-button').classList.add('show');
        isRotating = true;
        document.getElementById('back-button').classList.remove('show');
        buttonContainer.classList.remove('visible');
        buttonContainer.classList.remove('fade-out'); 
      }, 1500); 
    }

    function moveToRegion(position, lookAt) {
      const duration = 1500;
      const startTime = performance.now();

      const startPos = camera.position.clone();
      const startLookAt = new THREE.Vector3();
      camera.getWorldDirection(startLookAt);

      function animateCamera(time) {
        const elapsed = time - startTime;
        const t = Math.min(elapsed / duration, 1);

        camera.position.lerpVectors(startPos, position, t);
        const currentLookAt = startLookAt.clone().lerp(lookAt, t);
        camera.lookAt(currentLookAt);

        if (t < 1) {
          requestAnimationFrame(animateCamera);
        }
      }

      requestAnimationFrame(animateCamera);
    }

    const regions = {
      southAmerica: {
        position: new THREE.Vector3(500, -300, 1200),
        lookAt: new THREE.Vector3(0, -250, 0),
      },
      northAmerica: {
        position: new THREE.Vector3(-200, 1000, 750),
        lookAt: new THREE.Vector3(0, 150, 0),
      },
      centralAmerica: {
        position: new THREE.Vector3(50, 150, 850),
        lookAt: new THREE.Vector3(0, 100, 0),
      },
    };

    // Cargar las texturas
const textureLoader = new THREE.TextureLoader();
const southAmericaTexture = textureLoader.load('textures/SA.jpg');
const northAmericaTexture = textureLoader.load('textures/NA.jpg');
const centralAmericaTexture = textureLoader.load('textures/CAM.jpg');

// Asignar la textura inicial a la Tierra
earth.material.map = normalTexture;
earth.material.needsUpdate = true;

// Función para cambiar la textura con efecto de fade-in
function changeEarthTexture(region) {
  let newTexture;

  switch (region) {
    case 'southAmerica':
      newTexture = southAmericaTexture;
      break;
    case 'northAmerica':
      newTexture = northAmericaTexture;
      break;
    case 'centralAmerica':
      newTexture = centralAmericaTexture;
      break;
    default:
      newTexture = normalTexture;
  }

  // Crear un material temporal con la nueva textura
  const newMaterial = new THREE.MeshStandardMaterial({
    map: newTexture,
    transparent: true,
    opacity: 0, // Inicia con opacidad 0
  });

  // Crear una malla temporal con la nueva textura
  const tempEarth = new THREE.Mesh(earth.geometry, newMaterial);
  scene.add(tempEarth); // Añadir la malla temporal a la escena

  // Animación de fade-in
  let fadeDuration = 1000; // 1 segundo
  let startTime = performance.now();

  function animateFade(time) {
    let elapsed = time - startTime;
    let t = Math.min(elapsed / fadeDuration, 1); // Normaliza entre 0 y 1

    newMaterial.opacity = t; // Aumenta la opacidad

    if (t < 1) {
      requestAnimationFrame(animateFade);
    } else {
      // Cuando la animación termina, cambiar la textura real y eliminar la malla temporal
      earth.material.map = newTexture;
      earth.material.needsUpdate = true;
      scene.remove(tempEarth);
    }
  }

  requestAnimationFrame(animateFade);
}

// Añadir eventos a los botones
document.querySelectorAll('.region-button').forEach((button, index) => {
  button.addEventListener('click', function() {
    clickSound.play();

    switch (index) {
      case 0:
        changeEarthTexture('southAmerica');
        moveToRegion(regions.southAmerica.position, regions.southAmerica.lookAt);
        break;
      case 1:
        changeEarthTexture('northAmerica');
        moveToRegion(regions.northAmerica.position, regions.northAmerica.lookAt);
        break;
      case 2:
        changeEarthTexture('centralAmerica');
        moveToRegion(regions.centralAmerica.position, regions.centralAmerica.lookAt);
        break;
    }
  });
});

    const countriesData = {
      "Ecuador": {
        lat: -1.67,
        lon: 11.56,
        capital: "Quito",
        population: "17,000,000",
        flag: "media/images/Ecuador.jpg",
        anthem: "media/audio/himnos/Ecuador.mp3",
        video: "media/videos/Ecuador.mp4",
        clickMargin: 3  
      },
      "Colombia": {
        lat: 1.99,
        lon: 17.64,
        capital: "Bogotá",
        population: "50,000,000",
        flag: "media/images/Colombia.png",
        anthem: "media/audio/himnos/Colombia.mp3",
        video: "media/videos/Colombia.mp4",
        clickMargin: 6  
      },
      "Perú": {
        lat: -9.48,
        lon: 9.81,
        capital: "Lima",
        population: "30,000,000",
        flag: "media/images/Peru.jpg",
        anthem: "media/audio/himnos/Peru.mp3",
        video: "media/videos/Peru.mp4" 
      },
     "Venezuela": {
    lat: 7.55,
    lon: 25.85,
    capital: "Caracas",
    population: "28,000,000",
    flag: "media/images/Venezuela.jpg",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Venezuela.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Venezuela.mp4" 
},
  "Brasil": {
    lat: -10.44,
    lon: 37.46,
    capital: "Brasilia",
    population: "211,000,000",
    flag: "media/images/Brasil.jpg",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Brasil.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Brasil.mp4", 
    clickMargin: 10 
  },
  "Argentina": {
    lat: -30.75,
    lon: 25.44,
    capital: "Buenos Aires",
    population: "45,000,000",
    flag: "media/images/Argentina.jpg",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Argentina.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Argentina.mp4" 
  },
  "Chile": {
    lat: -28.30,
    lon: 18.50,
    capital: "Santiago",
    population: "19,611,704",
    flag: "media/images/Chile.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Chile.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Chile.mp4" 
  },
  "Bolivia": {
    lat: -15.92,
    lon: 27.75,
    capital: "Sucre",
    population: "11,513,100",
    flag: "media/images/Bolivia.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Bolivia.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Bolivia.mp4",
    clickMargin: 4  
  },
  "Uruguay": {
    lat: -30.95,
    lon: 33.87,
    capital: "Montevideo",
    population: "3,500,000",
    flag: "media/images/Uruguay.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Uruguay.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Uruguay.mp4" 
  },
  "Paraguay": {
    lat: -20.66,
    lon: 31.86,
    capital: "Asunción",
    population: "7,000,000",
    flag: "media/images/Paraguay.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Paraguay.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Paraguay.mp4" 
  },
  "Guyana": {
    lat: 4.62,
    lon: 31.03,
    capital: "Georgetown",
    population: "800,000",
    flag: "media/images/Guyana.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Guyana.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Guyana.mp4",
    clickMargin: 2  
  },
  "Surinam": {
    lat: 4.33,
    lon: 34.12,
    capital: "Paramaribo",
    population: "600,000",
    flag: "media/images/Surinam.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/Surinam.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/Surinam.mp4",
    clickMargin: 2  
  },
  "Guayana Francesa": {
    lat: 4.15,
    lon: 37.01,
    capital: "Cayena",
    population: "300,000",
    flag: "media/images/GuayanaF.png",  // Ruta de la imagen de la bandera
    anthem: "media/audio/himnos/GuayanaF.mp3",  // Ruta del archivo de audio del himno
    video: "media/videos/GuayanaF.mp4",
    clickMargin: 1 
  },
"México": {
  lat: 22.53,
  lon: -16.41,
  capital: "Ciudad de México",
  population: "129,150,971",
  flag: "media/images/Mexico.png",
  anthem: "media/audio/himnos/Mexico.mp3",
  video: "media/videos/Mexico.mp4",
  clickMargin: 10 
},
"Estados Unidos": {
  lat: 38.90,
  lon: -10.49,
  capital: "Washington D.C.",
  population: "331,893,745",
  flag: "media/images/USA.jpg",
  anthem: "media/audio/himnos/USA.mp3",
  video: "media/videos/USA.mp4",
  clickMargin: 13 
},

"Canadá": {
  lat: 55.13,
  lon: -14.33,
  capital: "Ottawa",
  population: "38,246,000",
  flag: "media/images/Canada.jpg",
  anthem: "media/audio/himnos/Canada.mp3",
  video: "media/videos/Canada.mp4",
  clickMargin: 10 
},
"Belice": {
        lat: 17.39,
        lon: 1.47,
        capital: "Belmopán",
        population: "419,199",
        flag: "media/images/Belice.png",
        anthem: "media/audio/himnos/Belice.mp3",
        video: "media/videos/Belice.mp4",
        clickMargin: 1 
    },
    "Guatemala": {
        lat: 15.14,
        lon: -1.22,
        capital: "Ciudad de Guatemala",
        population: "17.9 millones",
        flag: "media/images/Guatemala.png",
        anthem: "media/audio/himnos/Guatemala.mp3",
        video: "media/videos/Guatemala.mp4",
        clickMargin: 2 
    },
    "El Salvador": {
        lat: 13.7942,
        lon: 1.11,
        capital: "San Salvador",
        population: "6.5 millones",
        flag: "media/images/El_Salvador.png",
        anthem: "media/audio/himnos/El_Salvador.mp3",
        video: "media/videos/El_Salvador.mp4",
        clickMargin: 1 
    },
    "Honduras": {
        lat: 14.82,
        lon: 3.27,
        capital: "Tegucigalpa",
        population: "10.2 millones",
        flag: "media/images/Honduras.png",
        anthem: "media/audio/himnos/Honduras.mp3",
        video: "media/videos/Honduras.mp4",
        clickMargin: 2 
    },
    "Nicaragua": {
        lat: 12.54,
        lon: 6.28,
        capital: "Managua",
        population: "6.9 millones",
        flag: "media/images/Nicaragua.png",
        anthem: "media/audio/himnos/Nicaragua.mp3",
        video: "media/videos/Nicaragua.mp4",
        clickMargin: 2 
    },
    "Costa Rica": {
        lat: 9.92,
        lon: 6.03,
        capital: "San José",
        population: "5.2 millones",
        flag: "media/images/CostaR.jpg",
        anthem: "media/audio/himnos/CostaR.mp3",
        video: "media/videos/CostaR.mp4",
        clickMargin: 2 
    },
    "Panamá": {
        lat: 9.18,
        lon: 10.32,
        capital: "Ciudad de Panamá",
        population: "4.5 millones",
        flag: "media/images/Panama.png",
        anthem: "media/audio/himnos/Panama.mp3",
        video: "media/videos/Panama.mp4"
    }
};

    function showCountryInfo(country, countryData) {
      document.getElementById('country-name').textContent = country;
      document.getElementById('capital').textContent = countryData.capital;
      document.getElementById('population').textContent = countryData.population;
      document.getElementById('flag').src = countryData.flag;
      document.getElementById('anthem').src = countryData.anthem;
      document.getElementById('video').src = countryData.video;
      document.getElementById('info-panel').classList.add('show');
    }

 document.getElementById('close-btn').addEventListener('click', function() {
  const anthem = document.getElementById('anthem');
  anthem.pause();
  anthem.currentTime = 0; // Reiniciar el audio al inicio

  // Detener el video
  const video = document.getElementById('video');
  video.pause();
  video.currentTime = 0; // Reiniciar el video al inicio
  document.getElementById('info-panel').classList.remove('show');
});
  </script>
</body>
</html>